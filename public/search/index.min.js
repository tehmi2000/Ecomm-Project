let itemList={};document.addEventListener("DOMContentLoaded",(function(){const queryText=window.decodeURIComponent(getQuery().query),displayQueryElement=document.querySelector("#query");let formattedQuery=queryText.split("+").join(" ");displayQueryElement.innerHTML=` ${formattedQuery}`,queryText&&""!==queryText&&fetchData(queryText,formattedQuery)}));const fetchData=(searchQuery,formattedQuery)=>{const container=document.querySelector("#item-container");let apiUrl;fetch(`/api/goods/all/search?query=${searchQuery}`).then((async function(response){try{let result=await response.json();if(container.innerHTML="",0===result.length)createNoItemTag(container,formattedQuery);else{let adsPosition=3;result.forEach((item,index)=>{index===adsPosition&&(placeAds(container),(adsbygoogle=window.adsbygoogle||[]).push({}),adsPosition+=3),itemList[`${item._id}`]=item,createItem(container,item)})}}catch(error){console.log(error)}})).catch((function(error){console.log(error)}))},createNoItemTag=function(container,query){container.style.justifyContent="center",container.style.alignItems="center",container.innerHTML=`<span id='no-item' class='cols'><img src="../assets/images/portfolium-robot.png" alt=""><span>Sorry, we couldn't find any item that matched '${query}'.</span></span>`},placeAds=function(container){let adsDiv=createComponent("DIV",null,["item","lg-100"]),script=create("script"),ins=createComponent("INS",null,["adsbygoogle"]);script.setAttribute("async",!0),script.src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js",ins.style.display="block",ins.style.width="100%",ins.setAttribute("data-ad-format","fluid"),ins.setAttribute("data-ad-layout-key","-fb+5w+4e-db+86"),ins.setAttribute("data-ad-client","ca-pub-6903692907552928"),ins.setAttribute("data-ad-slot","9318070099"),adsDiv=joinComponent(adsDiv,script,ins),container.appendChild(adsDiv)},loadRecentlyViewedProducts=function(sectionElement,recentProductContainer){if("sessionStorage"in window){let noOfRecentlyViewedItems=sessionStorage.length<=5?sessionStorage.length:6;if(noOfRecentlyViewedItems>=2){recentProductContainer.innerHTML="";for(let index=0;index<noOfRecentlyViewedItems;index++){let item=JSON.parse(sessionStorage.getItem(sessionStorage.key(index)));createItem(recentProductContainer,item)}}else sectionElement.style.display="none"}else sectionElement.style.display="none"},createItem=function(container,object){const saveHandler=function(evt){const itemID=evt.currentTarget.id.split("_")[1]},cartHandler=function(evt){const itemID=evt.currentTarget.id.split("_")[1];fetch(`/api/goods/save/${getCookie("univers-username").value}/addToCart`,{method:"post",body:JSON.stringify({item:itemList[itemID]}),headers:{"Content-Type":"application/json; charset=utf-8"}}).then((async function(response){try{console.log(response);let result=await response.json();console.log(result),displayResponse("Item has been carted successfully!")}catch(error){console.error(error)}})).catch((function(error){console.error(error)}))};let price=formatAsMoney(parseFloat(object["item-price"]),currencyLocale),imgSource=""===object["item-image"][0]?"/assets/images/nullimg.png":object["item-image"][0],a0=createComponent("SPAN",null,["item"]),img0=createComponent("IMG",null,["lazyload"]),span0=createComponent("SPAN",null,["lg-90","cols"]),span1=createComponent("SPAN",null,["item-name","cols"]),span10=createComponent("A",object["item-name"],["strip-link","line-clamp","line-clamp-2"]),span11=createComponent("SPAN",`${object["short-desc"]||"No summary available"}`,["line-clamp","line-clamp-1"]),span2=createComponent("SPAN",null,["item-control","cols","lg-100"]),span20=createComponent("SPAN",`${price}`,["item-number"]),span21=createComponent("SPAN",null,["rows","item-buttons"]),button20=create("BUTTON"),button21=create("BUTTON");span10.setAttribute("href",`/view/${object._id}`),a0.setAttribute("id",object._id),a0.setAttribute("data-href",`/view/${object._id}`),img0.setAttribute("data-src",`${imgSource}`),img0.setAttribute("alt",`${object["item-name"].toLowerCase()}`),button20.setAttribute("id",`save_${object._id}`),button21.setAttribute("id",`cart_${object._id}`),button20.addEventListener("click",saveHandler),button21.addEventListener("click",cartHandler),button20.innerHTML="Save",button21.innerHTML='<i class="icofont-cart"></i>',span21=joinComponent(span21,button20,button21),span1=joinComponent(span1,span10,span11),span2=joinComponent(span2,span20,span21),span0=joinComponent(span0,span1,span2),a0=joinComponent(a0,img0,span0),a0.addEventListener("click",(function(evt){window.location.href=`${evt.currentTarget.getAttribute("data-href")}`})),container.appendChild(a0)};window.addEventListener("load",(function(){const suggestionContainer=document.querySelector(".pane.sug #suggestion-container"),recentContainer=document.querySelector(".pane.recent #recent-container");createSuggestions(document.querySelector(".pane.sug"),suggestionContainer),loadRecentlyViewedProducts(document.querySelector("section#recent-section.pane.recent"),recentContainer)}));