let itemList={},filters={};document.addEventListener("DOMContentLoaded",(function(){const queryText=window.decodeURIComponent(getQuery().query),displayQueryElement=document.querySelector("#query"),filterBtn=document.querySelector("#modifiers-content button[data-apply-btn]"),clearFilterBtn=document.querySelector("#modifiers-content [data-clear-btn]"),filterForm=document.querySelector("form#modifiers-content");let formattedQuery=queryText.split("+").join(" ");displayQueryElement.innerHTML=` ${formattedQuery}`,queryText&&""!==queryText&&fetchData(queryText,formattedQuery),filterBtn.addEventListener("click",ev=>{let target=ev.currentTarget;target.textContent="applying filters...",target.classList.toggle("animate-filtering")}),clearFilterBtn.addEventListener("click",ev=>{window.location.reload()}),filterForm.addEventListener("submit",ev=>{ev.preventDefault(),filterSearch(queryText,`${formattedQuery} (filtered)`)}),loadFilterHandlers()}));const displayFilters=()=>{const element=document.querySelector("#modifiers + #modifiers-content");element.style.display="flex"===element.style.display?"none":"flex"},buildFilterQuery=function(encodedSearchQuery){let apiUrl="/api/goods/all/with-filter?",searchQueryUrl=`searchQuery=${encodedSearchQuery}`,tempApiUrl="";return Object.keys(filters).forEach(key=>{let urlVersion=null;switch(key){case"priceRange":case"discountRange":urlVersion=`${filters[key].min||0}-${filters[key].max||999999999999999}`;break;default:urlVersion=`${filters[key]}`}tempApiUrl=null===urlVersion?tempApiUrl:`${tempApiUrl}&${key}=${urlVersion}`}),apiUrl+=searchQueryUrl+tempApiUrl,console.log(apiUrl),apiUrl},filterSearch=(searchQuery,formattedQuery)=>{const displayQueryElement=document.querySelector("#query"),container=document.querySelector("#item-container"),filterBtn=document.querySelector("#modifiers-content button[data-apply-btn]");let apiUrl=buildFilterQuery(window.encodeURIComponent(searchQuery));container.innerHTML="",createDummyItem(container,6),setTimeout(()=>{displayFilters()},2e3),fetch(apiUrl).then((async function(response){try{let result=await response.json();if(console.log(result),container.innerHTML="",itemList={},filterBtn.textContent="Apply",filterBtn.classList.toggle("animate-filtering",!1),displayQueryElement.innerHTML=` ${formattedQuery}`,0===result.length)createNoItemTag(container,formattedQuery);else{let adsPosition=3;result.forEach((item,index)=>{index===adsPosition&&(placeAds(container),(adsbygoogle=window.adsbygoogle||[]).push({}),adsPosition+=3),itemList[`${item._id}`]=item,createItem(container,item)}),document.querySelectorAll(".item .item-name a:first-child").forEach(el=>{$clamp(el,{clamp:2})})}}catch(error){console.log(error)}})).catch((function(error){console.log(error)}))},fetchData=(searchQuery,formattedQuery)=>{const container=document.querySelector("#item-container");let apiUrl;fetch(`/api/goods/all/search?query=${searchQuery}`).then((async function(response){try{let result=await response.json();if(container.innerHTML="",0===result.length)createNoItemTag(container,formattedQuery);else{let adsPosition=3;result.forEach((item,index)=>{index===adsPosition&&(placeAds(container),(adsbygoogle=window.adsbygoogle||[]).push({}),adsPosition+=3),itemList[`${item._id}`]=item,createItem(container,item)}),document.querySelectorAll(".item .item-name a:first-child").forEach(el=>{$clamp(el,{clamp:2})})}}catch(error){console.log(error)}})).catch((function(error){console.log(error)}))},createNoItemTag=function(container,query){container.style.justifyContent="center",container.style.alignItems="center",container.innerHTML=`<span id='no-item' class='cols'><img src="../assets/images/portfolium-robot.png" alt=""><span>Sorry, we couldn't find any item that matched '${query}'.</span></span>`,createSuggestions(document.querySelector(".pane.sug"),document.querySelector(".pane.sug #suggestion-container"))},loadFilterHandlers=function(){let minPriceInput=document.querySelector("#modifiers-content [name='min-price-range']"),maxPriceInput=document.querySelector("#modifiers-content [name='max-price-range']"),discountOnlyCheck=document.querySelector("#modifiers-content [name='is-discounted']");minPriceInput.addEventListener("input",e=>{filters.priceRange||(filters.priceRange={}),filters.priceRange.min=""===e.currentTarget.value?0:parseInt(e.currentTarget.value)}),maxPriceInput.addEventListener("input",e=>{filters.priceRange||(filters.priceRange={}),filters.priceRange.max=""===e.currentTarget.value?999999999999999:parseInt(e.currentTarget.value)}),discountOnlyCheck.addEventListener("change",e=>{filters.discount=!filters.discount||!filters.discount,console.log(filters)})},placeAds=function(container){let adsDiv=createComponent("DIV",null,["item","lg-100"]),script=create("script"),ins=createComponent("INS",null,["adsbygoogle"]);script.setAttribute("async",!0),script.src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js",ins.style.display="block",ins.style.width="100%",ins.setAttribute("data-ad-format","fluid"),ins.setAttribute("data-ad-layout-key","-fb+5w+4e-db+86"),ins.setAttribute("data-ad-client","ca-pub-6903692907552928"),ins.setAttribute("data-ad-slot","9318070099"),adsDiv=joinComponent(adsDiv,script,ins),container.appendChild(adsDiv)},createItem=function(container,object){const saveHandler=function(evt){const itemID=evt.currentTarget.id.split("_")[1]},cartHandler=function(evt){const itemID=evt.currentTarget.id.split("_")[1];fetch(`/api/goods/save/${getCookie("univers-username").value}/addToCart`,{method:"post",body:JSON.stringify({item:itemList[itemID]}),headers:{"Content-Type":"application/json; charset=utf-8"}}).then((async function(response){try{console.log(response);let result=await response.json();console.log(result),displayResponse("Item has been carted successfully!")}catch(error){console.error(error)}})).catch((function(error){console.error(error)}))};let price=formatAsMoney(parseInt(object["item-price"]),currencyLocale),a0=createComponent("SPAN",null,["item"]),img0=createComponent("IMG",null,["lazyload"]),span0=createComponent("SPAN",null,["lg-100","cols"]),span1=createComponent("SPAN",null,["item-name","cols"]),span10=createComponent("A",object["item-name"],["strip-link"]),span11=createComponent("SPAN",`${object["short-desc"]||"No summary available"}`),span2=createComponent("SPAN",null,["item-control","rows","lg-100"]),span20=createComponent("SPAN",`${price}`,["item-number"]),span21=createComponent("SPAN",null,["rows","item-buttons"]),button20=create("BUTTON"),button21=create("BUTTON");span10.setAttribute("href",`/view/${object._id}`),a0.setAttribute("id",object._id),a0.setAttribute("data-href",`/view/${object._id}`),img0.setAttribute("data-src",`${object["item-image"][0]}`),button20.setAttribute("id",`save_${object._id}`),button21.setAttribute("id",`cart_${object._id}`),button20.addEventListener("click",saveHandler),button21.addEventListener("click",cartHandler),button20.innerHTML="Save",button21.innerHTML='<i class="icofont-cart"></i>',span21=joinComponent(span21,button20,button21),span1=joinComponent(span1,span10,span11),span2=joinComponent(span2,span20,span21),span0=joinComponent(span0,span1,span2),a0=joinComponent(a0,img0,span0),a0.addEventListener("click",(function(evt){window.location.href=`${evt.currentTarget.getAttribute("data-href")}`})),container.appendChild(a0)},createDummyItem=function(container,number){for(let n=0;n<number;n++){let a0=createComponent("SPAN",null,["dummy","item"]),img0=create("IMG"),span0=createComponent("SPAN",null,["cols","lg-80"]),span1=createComponent("SPAN",null,["item-name"]),span2=createComponent("SPAN",null,["item-desc"]),span3=createComponent("SPAN",null,["bottom-wrapper","rows"]),span4=createComponent("SPAN",null,["item-price"]),span5=createComponent("SPAN",null,["rows","item-buttons"]),span6=create("SPAN"),span7=create("SPAN");img0.setAttribute("src",""),span5=joinComponent(span5,span6,span7),span3=joinComponent(span3,span4,span5),span0=joinComponent(span0,span1,span2,span3),a0=joinComponent(a0,img0,span0),container.appendChild(a0)}};