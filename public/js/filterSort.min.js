let filters={};const buildFilterQuery=function(encodedSearchQuery){let apiUrl="/api/goods/all/with-filter?",searchQueryUrl=`searchQuery=${encodedSearchQuery}`,tempApiUrl="";return Object.keys(filters).forEach(key=>{let urlVersion=null;switch(key){case"priceRange":case"discountRange":urlVersion=`${filters[key].min||0}-${filters[key].max||999999999999999}`;break;default:urlVersion=`${filters[key]}`}tempApiUrl=null===urlVersion?tempApiUrl:`${tempApiUrl}&${key}=${urlVersion}`}),apiUrl+=searchQueryUrl+tempApiUrl,console.log(apiUrl),apiUrl},filterSearch=(searchQuery,formattedQuery)=>{const displayQueryElement=document.querySelector("#query"),container=document.querySelector("#item-container"),filterBtn=document.querySelector("#modifiers-content button[data-apply-btn]");let apiUrl=buildFilterQuery(window.encodeURIComponent(searchQuery));container.innerHTML="",createDummyItem(container,6),setTimeout(()=>{displayFilters()},2e3),fetch(apiUrl).then((async function(response){try{let result=await response.json();if(container.innerHTML="",itemList={},filterBtn.textContent="Apply",filterBtn.classList.toggle("animate-filtering",!1),displayQueryElement.innerHTML=` ${formattedQuery}`,0===result.length)createNoItemTag(container,formattedQuery);else{let adsPosition=3;result.forEach((item,index)=>{index===adsPosition&&(placeAds(container),(adsbygoogle=window.adsbygoogle||[]).push({}),adsPosition+=3),itemList[`${item._id}`]=item,createItem(container,item)}),document.querySelectorAll(".item .item-name a:first-child").forEach(el=>{$clamp(el,{clamp:2})})}}catch(error){console.error(error)}})).catch((function(error){console.error(error)}))},loadFilterHandlers=function(){let minPriceInput=document.querySelector("#modifiers-content [name='min-price-range']"),maxPriceInput=document.querySelector("#modifiers-content [name='max-price-range']"),discountOnlyCheck=document.querySelector("#modifiers-content [name='is-discounted']");minPriceInput.addEventListener("input",e=>{filters.priceRange||(filters.priceRange={}),filters.priceRange.min=""===e.currentTarget.value?0:parseInt(e.currentTarget.value)}),maxPriceInput.addEventListener("input",e=>{filters.priceRange||(filters.priceRange={}),filters.priceRange.max=""===e.currentTarget.value?999999999999999:parseInt(e.currentTarget.value)}),discountOnlyCheck.addEventListener("change",e=>{filters.discount=!filters.discount||!filters.discount,console.log(filters)})};document.addEventListener("DOMContentLoaded",(function(){let modifiersTab=document.querySelector("#modifiers");const queryText=window.decodeURIComponent(getQuery().query),formattedQuery=queryText.split("+").join(" ");if(modifiersTab){let filterBtn=document.querySelector("#modifiers-content button[data-apply-btn]"),clearFilterBtn=document.querySelector("#modifiers-content [data-clear-btn]"),filterForm=document.querySelector("form#modifiers-content");filterBtn.addEventListener("click",ev=>{let target=ev.currentTarget;target.textContent="applying filters...",target.classList.toggle("animate-filtering")}),clearFilterBtn.addEventListener("click",ev=>{window.location.reload()}),filterForm.addEventListener("submit",ev=>{ev.preventDefault(),filterSearch(queryText,`${formattedQuery} (filtered)`)}),loadFilterHandlers()}}));