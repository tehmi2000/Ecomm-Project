getCookie("univers-username")||window.location.replace(`/login?redirect=true&redirect_url=${window.encodeURIComponent(window.location.href)}`);const itemID=getQuery().itemid,globals={},displayUploadState=function(statusText,end,status){status=status||200,end=end||null;const container=document.querySelector("#post-box .gallery .status-bar");container.style.display="block",container.innerHTML=statusText,end&&!0===end&&setTimeout(()=>{container.style.display="none"},5e3),container.style.backgroundColor=status>=400?"rgba(255, 25, 25, 0.85)":"rgba(54, 177, 248, 0.85)"},imageUploadHandler=function(evt){const uploadImage=(name,file)=>{const fd=new FormData;fd.append(name,file),fetch("/upload",{method:"POST",body:fd}).then(async response=>{let result=await response.json(),[data]=result;200===data.status?(document.querySelector(`#${name}`).setAttribute("data-version",data.version),document.querySelector(`label[for='${name}']`).innerHTML="",Object.keys(imgUrls).indexOf(name)===Object.keys(imgUrls).length-1&&displayUploadState("Upload Complete!",!0)):(document.querySelector(`#${name}_upload-action`).classList.toggle("progress",!1),document.querySelector(`#${name}_upload-action`).classList.toggle("icofont-check",!0),document.querySelector(`#${name}_upload-action`).classList.toggle("icofont-refresh",!1),displayUploadState("Upload Failed!",!0,data.status))}).catch(error=>{console.log(error)})},reader=new FileReader,elementId=evt.target.id,file=evt.target.files[0];file&&reader.readAsDataURL(file),reader.onload=function(){const previewElement=document.querySelector(`label[for='${elementId}']`);previewElement.innerHTML="",previewElement.style.backgroundImage=`url(${reader.result})`;let divB=createComponent("DIV",null,["rows"]),uploadB=createComponent("span",null,["rows","icofont-check","img-action"]),deleteB=createComponent("span",null,["rows","icofont-close","img-action"]);divB.setAttribute("id",`${elementId}_action-container`),uploadB.setAttribute("id",`${elementId}_upload-action`),deleteB.setAttribute("id",`${elementId}_delete-action`),uploadB.addEventListener("click",(function(evt){evt.currentTarget.classList.toggle("progress",!0),evt.currentTarget.classList.toggle("icofont-check",!1),evt.currentTarget.classList.toggle("icofont-refresh",!0),displayUploadState(`Uploading Image (${Object.keys(imgUrls).indexOf(elementId)+1}/${Object.keys(imgUrls).length})`),uploadImage(elementId,file)})),deleteB.addEventListener("click",(function(evt){previewElement.style.backgroundImage="none",previewElement.innerHTML=`Click to insert image<br>(${elementId.split("-")[2]} of 4)`,document.querySelector(`#${elementId}`).value="",delete imgUrls[elementId],document.querySelector(`#${elementId}`).removeAttribute("disabled")})),divB=joinComponent(divB,uploadB,deleteB),previewElement.appendChild(divB),document.querySelector(`#${elementId}`).setAttribute("disabled",!0),imgUrls[elementId]=file.name}},formHandler=function(evt){const setState=function(state,label){label=label||"Uploading To Store...";const submitBtn=document.querySelector('#post-box input[type="submit"]');!0===state?(submitBtn.value=label,submitBtn.classList.toggle("saving",!0),submitBtn.setAttribute("disabled",!0)):(submitBtn.value="Add to Store",submitBtn.classList.toggle("saving",!1),submitBtn.removeAttribute("disabled"))};evt.preventDefault();const submitForm=function(){let categoryField=[],imageField=[];forEach(document.querySelectorAll("[name='categories']:checked"),(function(field){categoryField.push(field.value)})),document.querySelectorAll("[name='item-image']").forEach((function(field){""!==field.value&&imageField.push(field.getAttribute("data-version")||"")})),imageField=imageField.map((imgVersionNumber,index)=>`v${imgVersionNumber}/`+imgUrls[`preview-image-${index+1}`]);const bodyValue={"item-image":imageField,"item-name":document.querySelector("[name='item-name']").value,"short-desc":document.querySelector("[name='item-short-desc']").value,"item-desc":preFormatInput(document.querySelector("[name='item-desc']").value),categories:categoryField,sellerID:document.querySelector("[name='sellerID']").value,"item-price":parseFloat(document.querySelector("[name='item-price']").value),"item-qty":parseInt(document.querySelector("[name='item-qty']").value)};fetch("/api/goods/save",{method:"POST",body:JSON.stringify(bodyValue),headers:{"Content-Type":"application/json; charset=utf-8"}}).then((async function(response){try{let result;(await response.json()).error?(alert("Something unexpected happened. Try again!"),setState(!1)):(alert("Saved to Store!"),setState(!1),window.location.href="/myprofile/products/my-store/")}catch(error){console.error(error)}})).catch((function(error){console.error(error)}))};setState(!0),fetch(`/api/vendors/${document.querySelector("[name='sellerID']").value}`).then((async function(response){try{let result=await response.json();result.length>0&&result[0].error?(alert("SellerID is Invalid!"),setState(!1)):submitForm()}catch(error){console.error(error)}})).catch((function(error){console.error(error)}))},placeAds=function(container){let adsDiv=createComponent("DIV",null,["item"]),script=create("script"),ins=createComponent("INS",null,["adsbygoogle"]);script.setAttribute("async",!0),script.src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js",ins.style.display="block",ins.style.width="100%",ins.setAttribute("data-ad-format","fluid"),ins.setAttribute("data-ad-layout-key","-fb+5w+4e-db+86"),ins.setAttribute("data-ad-client","ca-pub-6903692907552928"),ins.setAttribute("data-ad-slot","9318070099"),adsDiv=joinComponent(adsDiv,script,ins),container.appendChild(adsDiv)},createCheckOption=function(container,option){const id=`cat-option-${genHex(4)}`;let span0=createComponent("SPAN",null,["wrapper"]);const input0=create("INPUT"),label0=createComponent("LABEL",option.title);input0.setAttribute("type","checkbox"),input0.setAttribute("name","categories"),input0.setAttribute("value",option.title),input0.setAttribute("id",id),label0.setAttribute("for",id),input0.addEventListener("change",(function(evt){let categoryOption;document.querySelector(`[value='${evt.target.value}']+label`).style.color=!0===evt.target.checked?"orangered":"black"})),span0=joinComponent(span0,input0,label0),container.appendChild(span0)},getAllCategories=function(){fetch("/api/categories").then(async response=>{try{let categoryList;(await response.json()).forEach(element=>{createCheckOption(document.querySelector("#option-box"),element)})}catch(err){console.error(err)}}).catch((function(error){console.error(error)}))},getAllSizes=function(){let itemSizesSuccessCallback;fetchAndCacheData("/api/goods/item-sizes",(function(result){let container=document.querySelector("#props-box #size-tab select");globals.itemSizes=result,container.innerHTML="";let elementOptions=result.map(item=>{const opt=createComponent("OPTION",item.name);return opt.value=item.name,opt});container=joinComponent(container,...elementOptions)}))},loadNeededApis=function(){getAllCategories(),getAllSizes()},loadElementHandlers=function(productData){if(null!==productData){let previewImgContainer=document.querySelector("#addToStore-form .preview-pane .slider");document.querySelector(".control-body #subtitle").textContent=`Product ID: ${itemID}`;let arrayOfImgElement=productData["item-image"].map((imgLink,index)=>{let imgElement=createComponent("IMG",null,["preview-img","lazyload"]);return imgElement.src="/assets/images/nullimg.png",imgElement.setAttribute("data-src",imgLink),imgElement.alt=`${productData["item-name"]} ${index}`,imgElement});previewImgContainer.innerHTML="",arrayOfImgElement.forEach(el=>{previewImgContainer.appendChild(el)});let displayImgContainer=document.querySelector("#addToStore-form #preview-image-1"),displayImgInput=document.querySelector("#addToStore-form #changepic");displayImgContainer.style.backgroundImage=`url(${productData["item-image"][0]})`}document.querySelectorAll("#post-box .tab-controls > *").forEach(element=>{element.addEventListener("click",(function(evt){let tabID=evt.currentTarget.getAttribute("data-id");document.querySelector(`#${tabID}`).style.display="flex",document.querySelector(`.tab-controls [data-id='${tabID}']`).style.display="none"}))}),document.querySelectorAll("#props-box [id$='-tab'] .heading > *:last-child").forEach(element=>{element.addEventListener("click",(function(evt){let propPaneID=evt.currentTarget.getAttribute("data-id");document.querySelector(`#${propPaneID}`).style.display="none",document.querySelector(`.tab-controls [data-id='${propPaneID}']`).style.display="block"}))}),document.querySelector("#props-box #size-tab select").addEventListener("change",(function(evt){const container=document.querySelector("#props-box #size-tab #size-props");let selectedObject,elementOptions=globals.itemSizes.find(item=>item.name===evt.currentTarget.value).sizes.map(item=>{const opt=createComponent("SPAN",item,["size-item","rows"]);return opt});container.innerHTML="",container=joinComponent(container,...elementOptions)}))},checkForVendorship=()=>{fetch(`/api/vendors/${getCookie("univers-username").value}`).then((async function(response){try{let cover=document.querySelector(".vendor-bg-cover"),result=await response.json();result.length>0&&result[0].error?cover.style.top="0vh":loadNeededApis()}catch(error){console.error(error)}})).catch(error=>{console.error(error)})},getProductDetails=function(){null!==itemID&&fetch(`/api/goods/${itemID}`).then((async function(response){try{let result=await response.json(),[product]=result;loadElementHandlers(product)}catch(error){console.error(error)}})).catch(error=>{console.error(error)})},initializeForm=function(){document.querySelector(".control-body .body").style.height="auto",checkForVendorship(),getProductDetails()};document.addEventListener("DOMContentLoaded",(function(){initializeForm()}));