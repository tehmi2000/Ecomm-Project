getCookie("univers-username")||window.location.replace(`/login?redirect=true&redirect_url=${window.encodeURIComponent(window.location.href)}`);const imgUrls={},globals={cart:{items:[],total:0,netTotal:0,vouchers:[]},saved:{items:[]},store:{items:[]},imgSpace:4};document.addEventListener("DOMContentLoaded",(function(){loadHandlers(),getMyCart()}));const loadHandlers=function(){let paymentBtn=document.querySelector("#confirm-payment-btn"),promoApplyBtn=document.querySelector("#promo-apply-btn"),listOfSelectors=['[name="delivery-location"]'];paymentBtn.addEventListener("click",(function(ev){let target=ev.currentTarget;isDataProvidedComplete(listOfSelectors)&&(target.classList.contains("clicked")||(target.classList.add("clicked"),target.textContent="Loading payment gateway...",getPaymentParams()))})),promoApplyBtn.addEventListener("click",createPromo)},createNoItemTag=function(container,text){container.style.justifyContent="center",container.style.alignItems="center",container.innerHTML=`<span id='no-item'>${text}</span><a id="go-shopping-btn" href="/">START SHOPPING</a>`},placeAds=function(container){let adsDiv=createComponent("DIV",null,["item"]),script=create("script"),ins=createComponent("INS",null,["adsbygoogle"]);script.setAttribute("async",!0),script.src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js",ins.style.display="block",ins.style.width="100%",ins.setAttribute("data-ad-format","fluid"),ins.setAttribute("data-ad-layout-key","-fb+5w+4e-db+86"),ins.setAttribute("data-ad-client","ca-pub-6903692907552928"),ins.setAttribute("data-ad-slot","9318070099"),adsDiv=joinComponent(adsDiv,script,ins),container.appendChild(adsDiv)},calculateCartTotal=function(items){globals.cart.total=items.reduce((total,current)=>{const price=current["item-price"],qty=current["item-qty"];return total+=parseInt(price)*qty},0)},calculateTotalBill=function(vouchers=[]){let data={shipping:600,cart:globals.cart.total,vat:.075*globals.cart.total};return{...data,total:data.shipping+data.cart+data.vat-vouchers.reduce((total,nextVoucher)=>total+nextVoucher.voucherValue,0)}},getMyCart=function(){const checkoutBtn=document.querySelector("[data-pay-btn]");document.querySelector(".control-body #orders-box").style.display="flex",fetch(`/api/user/${getCookie("univers-username").value}/getCart`).then((async function(response){try{let items=await response.json();const container=document.querySelector("#orders-box");let cover=document.querySelector(".payment-bg-cover"),coverClose=document.querySelector(".payment-bg-cover .close-btn");document.querySelector("#subtitle").innerHTML=`${items.length} items`,container.innerHTML="",items.length>0?(calculateCartTotal(items),checkoutBtn.style.display="block",checkoutBtn.innerHTML="Checkout Now",checkoutBtn.addEventListener("click",(function(){let bills=calculateTotalBill();globals.cart.netTotal=bills.total,document.querySelector("#ship-fee").innerHTML=`+ ${formatAsMoney(bills.shipping)}`,document.querySelector("#cart-total").innerHTML=formatAsMoney(bills.cart),document.querySelector("#vat-fee").innerHTML=`+ ${formatAsMoney(bills.vat)}`,document.querySelector("#total-bill").innerHTML=formatAsMoney(bills.total),cover.style.top="0vh"})),coverClose.addEventListener("click",(function(evt){cover.style.top="-120vh"})),forEach(items,(function(item){globals.cart.items.push(item),createItems(item)})),document.querySelectorAll(".item .item-name").forEach(el=>{$clamp(el,{clamp:2})}),gsap.from(document.querySelectorAll("#orders-box > *"),.6,{x:"100vw",ease:"Power1.easeOut",stagger:.3})):createNoItemTag(container,"No item in your cart yet")}catch(error){console.log(error)}})).catch((function(error){console.log(error)}))},calculateVoucherValue=function({voucherType:voucherType,voucherValue:voucherValue}){return"percent"===voucherType?globals.cart.total*(voucherValue/100):voucherValue},isDataProvidedComplete=function(listOfElementSelectors){return listOfElementSelectors.map(selector=>{let element=document.querySelector(`${selector}`),valueIsEmpty;return!0===(""===element.value||element.value.length<=2)?(element.style.border="1px solid red",!1):(element.style.border="none",!0)}).reduce((currentValue,nextValue)=>currentValue&&nextValue)},getPaymentParams=function(){let modeOfDelivery=document.querySelector('[name="mode-of-delivery"]').value,deliveryLocation=""===document.querySelector('[name="delivery-location"]').value?null:document.querySelector('[name="delivery-location"]').value,paymentParams={nameOfBuyer:null,emailOfBuyer:"tehmi2000@gmail.com",items:globals.cart.items,netTotal:globals.cart.netTotal,vouchers:globals.cart.vouchers,modeOfDelivery:modeOfDelivery,deliveryLocation:deliveryLocation};loadPaystackGateway(paymentParams)},loadPaystackGateway=function(allCartData){console.log(allCartData),allCartData.reference=genHex(12),handleCartPaymentSuccess(allCartData),handler.openIframe()},handleCartPaymentSuccess=function(data){let apiUrl=`/api/goods/order/${getCookie("univers-username").value}/initiate`,apiOptions={method:"POST",body:JSON.stringify(data),headers:{"Content-Type":"application/json;charset=utf-8"}};fetch(apiUrl,apiOptions).then(async response=>{try{let result=await response.json();console.log(result)}catch(error){console.error(error)}}).catch(error=>{console.error(error)})},removeItem=function(item_id,type){const container=document.querySelector("#orders-box"),checkoutBtn=document.querySelector("[data-pay-btn]"),apiUrl="save"===type?"removeFromSaved":"removeFromCart";fetch(`/api/goods/save/${getCookie("univers-username").value}/${apiUrl}`,{method:"POST",body:JSON.stringify({itemID:item_id}),headers:{"Content-Type":"application/json; charset=utf-8"}}).then(async response=>{try{let result;if(await response.json()&&null===type){const element=document.querySelector(`#cartItem_${item_id}`);globals.cart.items=globals.cart.items.filter(item=>item._id!==item_id),calculateCartTotal(globals.cart.items),element.parentNode.removeChild(element),document.querySelector("#subtitle").innerHTML=`${globals.cart.items.length} items`,0===globals.cart.items.length&&(createNoItemTag(container,"No item in your cart yet"),checkoutBtn.style.display="none")}else{const element=document.querySelector(`#savedItem_${item_id}`);globals.saved.items=globals.saved.items.filter(item=>item._id!==item_id),element.parentNode.removeChild(element),document.querySelector("#subtitle").innerHTML=`${globals.saved.items.length} items`,0===globals.saved.items.length&&createNoItemTag(container,"No item saved yet")}}catch(error){console.error(error)}}).catch(error=>{console.error(error)})},createItems=function(items,type){type=type||null;const container=document.querySelector("#orders-box");let price=formatAsMoney(parseInt(items["item-price"]),currencyLocale),div0=createComponent("div",null,["item"]);const img0=createComponent("IMG",null,["lazyload"]);let div1=createComponent("DIV",null,["info","cols"]),div10=createComponent("div",null,["rows","top"]),div101=createComponent("DIV",`${items["item-brand"]||items.categories[0]}`,["item-brand"]),button101=createComponent("BUTTON",null,["strip-btn","icofont-close"]),span10=createComponent("SPAN",`${items["item-name"]} (x${items["item-qty"]})`,["item-name"]),span11=createComponent("SPAN",`${price}`,["item-price"]),span12=createComponent("SPAN",null,["item-controls"]);const button120=createComponent("BUTTON","Save For Later"),mainID="save"===type?`savedItem_${items._id}`:`cartItem_${items._id}`;div0.setAttribute("id",mainID),img0.setAttribute("id",`image_${items._id}`),img0.setAttribute("data-src",`${items["item-image"][0]}`),img0.setAttribute("alt",`${items["item-name"].toUpperCase()}`),button101.setAttribute("id",`remove_${items._id}`),img0.addEventListener("click",(function(evt){window.location.href=`/view/${evt.currentTarget.id.split("_")[1]}`})),button101.addEventListener("click",(function(evt){removeItem(evt.currentTarget.id.split("_")[1],type)})),div10=joinComponent(div10,div101,button101),span12=joinComponent(span12,button120),div1=joinComponent(div1,div10,span10,span11,span12),div0=joinComponent(div0,img0,div1),container.appendChild(div0)},removePromo=function(promoId){const container=document.querySelector("#orders-box"),checkoutBtn=document.querySelector("[data-pay-btn]"),apiUrl="save"===type?"removeFromSaved":"removeFromCart";fetch(`/api/goods/save/${getCookie("univers-username").value}/${apiUrl}`,{method:"POST",body:JSON.stringify({itemID:item_id}),headers:{"Content-Type":"application/json; charset=utf-8"}}).then(async response=>{try{let result;if(await response.json()&&null===type){const element=document.querySelector(`#cartItem_${item_id}`);globals.cart.items=globals.cart.items.filter(item=>item._id!==item_id),calculateCartTotal(globals.cart.items),element.parentNode.removeChild(element),document.querySelector("#subtitle").innerHTML=`${globals.cart.items.length} items`,0===globals.cart.items.length&&(createNoItemTag(container,"No item in your cart yet"),checkoutBtn.style.display="none")}else{const element=document.querySelector(`#savedItem_${item_id}`);globals.saved.items=globals.saved.items.filter(item=>item._id!==item_id),element.parentNode.removeChild(element),document.querySelector("#subtitle").innerHTML=`${globals.saved.items.length} items`,0===globals.saved.items.length&&createNoItemTag(container,"No item saved yet")}}catch(error){console.error(error)}}).catch(error=>{console.error(error)})},createPromo=function(ev){let voucherInput=document.querySelector('[name="promo-code"]'),voucherInputValue=voucherInput.value;const createPromoElement=function(data){const container=document.querySelector("#promo-container");let price=formatAsMoney(data.voucherValue),div0=createComponent("DIV",null,["lg-100","rows","promo-item"]),span0=createComponent("SPAN",`${data.voucherName}`),span1=createComponent("SPAN",null,["rows"]),span10=createComponent("SPAN",`- ${price}`),button10=createComponent("BUTTON",null,["strip-btn","icofont-close"]);span1=joinComponent(span1,span10,button10),div0=joinComponent(div0,span0,span1),container.appendChild(div0)},validateVoucher=function(userVoucherName){let apiUrl=`/api/vouchers/${getCookie("univers-username").value}/confirmVoucher`;userVoucherName=userVoucherName.trim(),fetch(apiUrl,{method:"POST",body:JSON.stringify({voucherName:userVoucherName}),headers:{"Content-Type":"application/json;charset=utf-8"}}).then(async response=>{try{let result=await response.json();if(console.log(result),null!==result&&!0===result.isValid){let{voucherName:voucherName}=result,voucherValue,data={voucherValue:calculateVoucherValue(result),voucherName:voucherName};const voucherIsUsed=globals.cart.vouchers.findIndex(eachVoucher=>eachVoucher.voucherName===voucherName);voucherIsUsed<0&&(globals.cart.vouchers.push(Object.assign({},result,{...data})),console.log(globals.cart.vouchers),globals.cart.netTotal=calculateTotalBill(globals.cart.vouchers).total,createPromoElement(data),document.querySelector("#total-bill").innerHTML=formatAsMoney(globals.cart.netTotal))}}catch(error){console.error(error)}}).catch(error=>{console.error(error)})};voucherInputValue.length>2&&(validateVoucher(voucherInputValue),voucherInput.value="",l)};