getCookie("univers-username")||window.location.replace(`/login?redirect=true&redirect_url=${window.encodeURIComponent(window.location.href)}`);const imgUrls={},globals={cart:{items:[],total:0,netTotal:0},saved:{items:[]},store:{items:[]},imgSpace:4};document.addEventListener("DOMContentLoaded",(function(){getSavedItems()}));const createNoItemTag=function(container,text){container.style.justifyContent="center",container.style.alignItems="center",container.innerHTML=`<span id='no-item'>${text}</span><a id="go-shopping-btn" href="/">START SHOPPING</a>`},getSavedItems=function(){document.querySelector(".control-body #orders-box").style.display="flex",fetch(`/api/user/${getCookie("univers-username").value}/getSavedItems`).then((async function(response){try{let items=await response.json();const container=document.querySelector("#orders-box");if(document.querySelector("#subtitle").innerHTML=`${items.length} items`,container.innerHTML="",items.length>0){let adsPosition=3;items.forEach((function(item,index){index===adsPosition&&(placeAds(container),(adsbygoogle=window.adsbygoogle||[]).push({}),adsPosition+=3),globals.saved.items.push(item),createItems(item,"save")})),document.querySelectorAll(".item .item-name").forEach(el=>{$clamp(el,{clamp:2})}),gsap.from(document.querySelectorAll("#orders-box > *"),.6,{x:"100vw",ease:"Power1.easeOut",stagger:.3})}else createNoItemTag(container,"No saved item yet")}catch(error){console.log(error)}})).catch((function(error){console.log(error)}))},placeAds=function(container){let adsDiv=createComponent("DIV",null,["item"]),script=create("script"),ins=createComponent("INS",null,["adsbygoogle"]);script.setAttribute("async",!0),script.src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js",ins.style.display="block",ins.style.width="100%",ins.setAttribute("data-ad-format","fluid"),ins.setAttribute("data-ad-layout-key","-fb+5w+4e-db+86"),ins.setAttribute("data-ad-client","ca-pub-6903692907552928"),ins.setAttribute("data-ad-slot","9318070099"),adsDiv=joinComponent(adsDiv,script,ins),container.appendChild(adsDiv)},removeItem=function(item_id,type){const container=document.querySelector("#orders-box"),checkoutBtn=document.querySelector("[data-pay-btn]"),apiUrl="save"===type?"removeFromSaved":"removeFromCart";fetch(`/api/goods/save/${getCookie("univers-username").value}/${apiUrl}`,{method:"POST",body:JSON.stringify({itemID:item_id}),headers:{"Content-Type":"application/json; charset=utf-8"}}).then(async response=>{try{let result;if(await response.json()&&null===type){const element=document.querySelector(`#cartItem_${item_id}`);globals.cart.items=globals.cart.items.filter(item=>item._id!==item_id),calculateCartTotal(globals.cart.items),element.parentNode.removeChild(element),document.querySelector("#subtitle").innerHTML=`${globals.cart.items.length} items`,0===globals.cart.items.length&&(createNoItemTag(container,"No item in your cart yet"),checkoutBtn.style.display="none")}else{const element=document.querySelector(`#savedItem_${item_id}`);globals.saved.items=globals.saved.items.filter(item=>item._id!==item_id),element.parentNode.removeChild(element),document.querySelector("#subtitle").innerHTML=`${globals.saved.items.length} items`,0===globals.saved.items.length&&createNoItemTag(container,"No item saved yet")}}catch(error){console.error(error)}}).catch(error=>{console.error(error)})},createItems=function(items,type){type=type||null;const container=document.querySelector("#orders-box");let price=formatAsMoney(parseInt(items["item-price"])),div0=createComponent("div",null,["item"]);const img0=createComponent("IMG",null,["lazyload"]);let div1=createComponent("DIV",null,["info","cols"]),div10=createComponent("div",null,["rows","top"]),div101=createComponent("DIV",`${items["item-brand"]||items.categories[0]}`,["item-brand"]),button101=createComponent("BUTTON",null,["strip-btn","icofont-close"]),span10=createComponent("SPAN",`${items["item-name"]} (x${items["item-qty"]})`,["item-name"]),span11=createComponent("SPAN",`${price}`,["item-price"]),span12=createComponent("SPAN",null,["item-controls"]);const button120=createComponent("BUTTON","Save For Later"),mainID="save"===type?`savedItem_${items._id}`:`cartItem_${items._id}`;div0.setAttribute("id",mainID),img0.setAttribute("id",`image_${items._id}`),img0.setAttribute("alt",`${items["item-name"].toUpperCase()}`),img0.setAttribute("data-src",`${items["item-image"][0]}`),button101.setAttribute("id",`remove_${items._id}`),img0.addEventListener("click",(function(evt){window.location.href=`/view/${evt.currentTarget.id.split("_")[1]}`})),button101.addEventListener("click",(function(evt){removeItem(evt.currentTarget.id.split("_")[1],type)})),div10=joinComponent(div10,div101,button101),span12=joinComponent(span12,button120),div1=joinComponent(div1,div10,span10,span11,span12),div0=joinComponent(div0,img0,div1),container.appendChild(div0)},createCheckOption=function(container,option){const id=`cat-option-${genHex(4)}`;let span0=create("SPAN");const input0=create("INPUT"),label0=createComponent("LABEL",option.title);span0.classList.add("wrapper"),input0.setAttribute("type","checkbox"),input0.setAttribute("name","categories"),input0.setAttribute("value",option.title),input0.setAttribute("id",id),label0.setAttribute("for",id),input0.addEventListener("change",(function(evt){!0===evt.target.checked?document.querySelector(`[value='${evt.target.value}']+label`).style.color="orangered":document.querySelector(`[value='${evt.target.value}']+label`).style.color="black"})),span0=joinComponent(span0,input0,label0),container.appendChild(span0)};